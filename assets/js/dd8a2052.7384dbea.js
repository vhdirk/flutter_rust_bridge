"use strict";(self.webpackChunkflutter_rust_bridge=self.webpackChunkflutter_rust_bridge||[]).push([[1772],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>m});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),u=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},p=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=u(r),m=a,b=d["".concat(l,".").concat(m)]||d[m]||c[m]||i;return r?n.createElement(b,o(o({ref:t},p),{},{components:r})):n.createElement(b,o({ref:t},p))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,o=new Array(i);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var u=2;u<i;u++)o[u]=r[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},43630:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var n=r(87462),a=(r(67294),r(3905));const i={},o="Properties (Accessors)",s={unversionedId:"guides/types/arbitrary/rust-auto-opaque/properties",id:"guides/types/arbitrary/rust-auto-opaque/properties",title:"Properties (Accessors)",description:"The pub fields of an opaque struct will be automatically translated,",source:"@site/docs/guides/types/arbitrary/rust-auto-opaque/properties.md",sourceDirName:"guides/types/arbitrary/rust-auto-opaque",slug:"/guides/types/arbitrary/rust-auto-opaque/properties",permalink:"/flutter_rust_bridge/guides/types/arbitrary/rust-auto-opaque/properties",draft:!1,editUrl:"https://github.com/fzyzcjy/flutter_rust_bridge/tree/master/website/docs/guides/types/arbitrary/rust-auto-opaque/properties.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Override opaqueness",permalink:"/flutter_rust_bridge/guides/types/arbitrary/rust-auto-opaque/override-defaults"},next:{title:"Opaque inside translatable",permalink:"/flutter_rust_bridge/guides/types/arbitrary/rust-auto-opaque/opaque-in-translatable"}},l={},u=[{value:"Example",id:"example",level:2},{value:"Caveats",id:"caveats",level:2},{value:"Problem description",id:"problem-description",level:3},{value:"Solution 1",id:"solution-1",level:3},{value:"Solution 2",id:"solution-2",level:3},{value:"Solution 3",id:"solution-3",level:3}],p={toc:u};function c(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"properties-accessors"},"Properties (Accessors)"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"pub")," fields of an opaque struct will be automatically translated,\nsuch that it can be used as if it is a normal field."),(0,a.kt)("h2",{id:"example"},"Example"),(0,a.kt)("p",null,"Suppose we have the following opaque type:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-rust"},"pub struct MyOpaqueType {\n    pub name: String,\n    db: Database,\n}\n")),(0,a.kt)("p",null,"Then, the public field, ",(0,a.kt)("inlineCode",{parentName:"p"},"name"),", will be recognized. The getters and setters will be generated:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dart"},"// Auto-generated class\nclass MyOpaqueType {\n    String get name => ...;\n    set name(String value) => ...;\n    ...\n}\n")),(0,a.kt)("p",null,"Then, we can use it as if it is a normal field:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dart"},"var object = MyOpaqueType();\nobject.name += 'a';\nprint('Hi ${object.name}');\n")),(0,a.kt)("h2",{id:"caveats"},"Caveats"),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"There is no need to memorize anything here (or anything in doc) -\nthe code generator will provide warnings when detecting non-best-practices.")),(0,a.kt)("h3",{id:"problem-description"},"Problem description"),(0,a.kt)("p",null,"Because borrowed types are not (yet) supported, the current implementation clones the field when reading it.\nThis is no problem when the field type is something like integers, Strings, or ",(0,a.kt)("inlineCode",{parentName:"p"},"RustAutoOpaque<T>"),"s.\nHowever, it may be confusing in some scenarios.\nFor example,"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-rust"},"#[frb(opaque)]\npub struct A {\n    pub b: B,\n}\n\n#[frb(opaque)]\npub struct B {\n    pub c: i32,\n}\n")),(0,a.kt)("p",null,"Then, usage like"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dart"},"var a = A(...);\na.b.c += 1;\nprint(a.b.c); // unchanged\n")),(0,a.kt)("p",null,"may be confusing since the ",(0,a.kt)("inlineCode",{parentName:"p"},"a.b.c")," is not changed.\nThis is because each access to ",(0,a.kt)("inlineCode",{parentName:"p"},"a.b")," creates a brand new ",(0,a.kt)("inlineCode",{parentName:"p"},"B")," instance."),(0,a.kt)("h3",{id:"solution-1"},"Solution 1"),(0,a.kt)("p",null,"One solution is to just add ",(0,a.kt)("inlineCode",{parentName:"p"},"RustAutoOpaque<...>")," like below.\nIt will not affect other things, for example, the generated type will still be ",(0,a.kt)("inlineCode",{parentName:"p"},"B"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-rust"},"pub struct A {\n    pub b: RustAutoOpaque<B>,\n}\n")),(0,a.kt)("p",null,"It works because ",(0,a.kt)("inlineCode",{parentName:"p"},"RustAutoOpaque<T>")," is indeed an ",(0,a.kt)("inlineCode",{parentName:"p"},"Arc"),",\nthus the cloned ",(0,a.kt)("inlineCode",{parentName:"p"},"b")," will point to the very same object instead of a brand new object."),(0,a.kt)("p",null,"To create/read/write objects of type ",(0,a.kt)("inlineCode",{parentName:"p"},"RustAutoOpaque<...>"),", please refer to ",(0,a.kt)("a",{parentName:"p",href:"struct"},"this page"),"."),(0,a.kt)("h3",{id:"solution-2"},"Solution 2"),(0,a.kt)("p",null,"Another way is to make the struct non-opaque (possibly by adding ",(0,a.kt)("inlineCode",{parentName:"p"},"#[frb(non_opaque)]"),"). "),(0,a.kt)("h3",{id:"solution-3"},"Solution 3"),(0,a.kt)("p",null,"Yet another way is to utilize the ",(0,a.kt)("a",{parentName:"p",href:"../../../misc-features/proxy"},"proxy")," feature."),(0,a.kt)("p",null,"This may be the default generated code instead in the future.\nIf this simplifies your scenario a lot, feel free to create an issue to discuss."))}c.isMDXComponent=!0}}]);