"use strict";(self.webpackChunkflutter_rust_bridge=self.webpackChunkflutter_rust_bridge||[]).push([[7141],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),d=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=d(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=d(n),m=a,f=c["".concat(l,".").concat(m)]||c[m]||u[m]||i;return n?r.createElement(f,o(o({ref:t},p),{},{components:n})):r.createElement(f,o({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var d=2;d<i;d++)o[d]=n[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},45082:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var r=n(87462),a=(n(67294),n(3905));const i={},o="Hooking onto tasks",s={unversionedId:"manual/integrate/existing/android/tasks",id:"manual/integrate/existing/android/tasks",title:"Hooking onto tasks",description:"This is the same method used by the app template and also the easier one.",source:"@site/docs/manual/integrate/06-existing/03-android/01-tasks.md",sourceDirName:"manual/integrate/06-existing/03-android",slug:"/manual/integrate/existing/android/tasks",permalink:"/flutter_rust_bridge/manual/integrate/existing/android/tasks",draft:!1,editUrl:"https://github.com/fzyzcjy/flutter_rust_bridge/tree/master/website/docs/manual/integrate/06-existing/03-android/01-tasks.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Integrating with Android",permalink:"/flutter_rust_bridge/manual/integrate/existing/android/"},next:{title:"CMake with Gradle",permalink:"/flutter_rust_bridge/manual/integrate/existing/android/cmake"}},l={},d=[],p={toc:d};function u(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"hooking-onto-tasks"},"Hooking onto tasks"),(0,a.kt)("p",null,"This is the same method used by the app template and also the easier one.\nGo ahead and install ",(0,a.kt)("inlineCode",{parentName:"p"},"cargo-ndk")," if you have not already done so:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"cargo install cargo-ndk\n")),(0,a.kt)("p",null,"Next, add these lines",(0,a.kt)("sup",{parentName:"p",id:"fnref-1"},(0,a.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1"))," near the bottom of ",(0,a.kt)("inlineCode",{parentName:"p"},"android/app/build.gradle"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-gradle"},"[\n    new Tuple2('Debug', ''),\n    new Tuple2('Profile', '--release'),\n    new Tuple2('Release', '--release')\n].each {\n    def taskPostfix = it.first\n    def profileMode = it.second\n    tasks.whenTaskAdded { task ->\n        if (task.name == \"javaPreCompile$taskPostfix\") {\n            task.dependsOn \"cargoBuild$taskPostfix\"\n        }\n    }\n    tasks.register(\"cargoBuild$taskPostfix\", Exec) {\n        // Until https://github.com/bbqsrc/cargo-ndk/pull/13 is merged,\n        // this workaround is necessary.\n\n        def ndk_command = \"\"\"cargo ndk \\\n            -t armeabi-v7a -t arm64-v8a -t x86_64 -t x86 \\\n            -o ../android/app/src/main/jniLibs build $profileMode\"\"\"\n\n        workingDir \"../../$crate\"\n        environment \"ANDROID_NDK_HOME\", \"$ANDROID_NDK\"\n        if (org.gradle.nativeplatform.platform.internal.DefaultNativePlatform.currentOperatingSystem.isWindows()) {\n            commandLine 'cmd', '/C', ndk_command\n        } else {\n            commandLine 'sh', '-c', ndk_command\n        }\n    }\n}\n")),(0,a.kt)("p",null,"Note the ANDROID_NDK variable, this is a Gradle property that points to\nyour installation of the Android NDK. If you don't rely on portability,\nyou can hardcode this value, but note that it can be supplied by one\nof the many ",(0,a.kt)("inlineCode",{parentName:"p"},"gradle.properties")," scattered throughout your filesystem.\nThe most reliable way is to create a file at ",(0,a.kt)("inlineCode",{parentName:"p"},"~/.gradle/gradle.properties"),"\nand fill it with this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ANDROID_NDK=(path to NDK)\n")),(0,a.kt)("p",null,"Note the ABIs ",(0,a.kt)("inlineCode",{parentName:"p"},"x86_64")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"x86")," in ",(0,a.kt)("inlineCode",{parentName:"p"},"ndk_command")," are usually used for Android simulators. Feel free to remove them as needed."),(0,a.kt)("div",{className:"footnotes"},(0,a.kt)("hr",{parentName:"div"}),(0,a.kt)("ol",{parentName:"div"},(0,a.kt)("li",{parentName:"ol",id:"fn-1"},"This excerpt might be outdated, please check out\nthe ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/Desdaemon/flutter_rust_bridge_template/blob/main/android/app/build.gradle"},"source file")," at the ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/Desdaemon/flutter_rust_bridge_template"},"template repository"),".",(0,a.kt)("a",{parentName:"li",href:"#fnref-1",className:"footnote-backref"},"\u21a9")))))}u.isMDXComponent=!0}}]);